# 모델 학습 입력-출력 쌍 구성

## 요구사항
- **시작일**: 2021-04-30
- **입력 X**: 과거 20/40/60 영업일 데이터
- **출력 y**: 이후 20영업일 변동에 따른 레이블 [2/1/0]

## 동작 방식

### 1. 입력 윈도우 (X)
```python
# build_window_matrix 함수
start = asof - pd.tseries.offsets.BDay(T - 1)  # asof로부터 T-1 영업일 전
wdf = df[(df["date"] >= start) & (df["date"] <= asof)]
```

**예시 (T=20, asof=2021-04-30):**
- start = 2021-04-30 - 19영업일 = 2021-04-06
- X = [2021-04-06 ~ 2021-04-30] 20영업일 데이터
- ✓ **과거 데이터만 사용**

### 2. 출력 레이블 (y)
```python
# build_label_vector 함수
future_date = asof + pd.tseries.offsets.BDay(20)  # asof로부터 20영업일 후

base = df[df["date"] == asof]["close"]  # asof 시점 가격
fut = df[df["date"] == future_date]["close"]  # 20영업일 후 가격

rel = (fut / base - 1.0)  # 수익률

# 레이블 생성
y = 2  # if rel >= 10%
y = 1  # if 5% <= rel < 10%
y = 0  # else
```

**예시 (asof=2021-04-30):**
- base = 2021-04-30 가격
- fut = 2021-05-28 가격 (약 20영업일 후)
- y = 20영업일 수익률 버킷
- ✓ **미래 수익률 예측**

### 3. 시간 흐름
```
입력 X          현재         출력 y
[======]     asof       [======]
과거 T일        ↓          20영업일
             2021-04-30  →  2021-05-28
```

### 4. 학습 가능한 날짜 범위
```python
min_data_date = pd.Timestamp("2021-04-30")
max_training_date = asof - pd.tseries.offsets.BDay(20)

# 학습 가능: 2021-04-30 ~ (asof - 20영업일)
# 이유: 각 샘플에 대해 20영업일 후의 가격이 필요
```

**예시 (asof=2023-12-31):**
- 최대 학습일: 2023-12-31 - 20영업일 = 2023-12-05
- 학습 기간: 2021-04-30 ~ 2023-12-05

### 5. 샘플링 전략
- **월말 기준 샘플링**: 매월 마지막 영업일
- 하루마다 학습하면 데이터가 너무 많음
- 월말 기준으로 학습하여 적절한 샘플 수 유지

## 검증 포인트

✅ **시간 순서**: 과거 → 현재 → 미래 (올바름)
✅ **누수 없음**: X에 미래 데이터 없음
✅ **레이블**: asof 이후 20영업일 수익률
✅ **적용 범위**: T=20,40,60에 대해 동일

## 예시 데이터 흐름

```
asof = 2021-04-30

입력 X (T=20):
  - 기간: [2021-04-06 ~ 2021-04-30] 20영업일
  - 특성: log_return, vol_z, volatility20, mom20

출력 y:
  - 기준: 2021-04-30 가격
  - 목표: 2021-05-28 가격 (20영업일 후)
  - 레이블:
    2 if (5월28일 가격 / 4월30일 가격 - 1) >= 10%
    1 if 5% <= 수익률 < 10%
    0 else
```

## 중요 사항

⚠️ **예측 시점**: asof 시점의 데이터로 학습된 모델은 
- asof 이후 20영업일의 수익률을 예측
- 월 단위가 아닌 정확히 20영업일 기준

⚠️ **레이블 데이터 필요**: 학습하려면 asof 이후 20영업일의 실제 가격이 필요
- 즉, 예측하려는 시점(asof)으로부터 20영업일 후 데이터까지 있어야 함

