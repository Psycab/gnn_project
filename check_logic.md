# 입력-출력 쌍 검증

## 1. build_window_matrix (192-228행)

```python
start = asof - pd.tseries.offsets.BDay(T - 1)  # asof로부터 T-1 영업일 전
wdf = df[(df["date"] >= start) & (df["date"] <= asof)][...]
```

**결과**: [start ~ asof] 기간의 과거 데이터

예시 (T=20, asof=2021-05-31):
- start = 2021-05-31 - 19영업일 = 2021-05-06
- X = [2021-05-06 ~ 2021-05-31] 20영업일 데이터
- ✓ **과거 데이터 사용**

## 2. build_label_vector (231-256행)

```python
base = df[df["date"] == asof][["symbol", "close"]]
fut = df[df["date"] == next_me][["symbol", "close"]]
rel = (fut / base - 1.0)
```

**결과**: (next_me 가격 / asof 가격 - 1) * 100 = 미래 수익률

예시 (asof=2021-05-31, next_me=2021-06-30):
- base = 2021-05-31 가격
- fut = 2021-06-30 가격
- y = 6월 한 달 수익률
- ✓ **미래 수익률 예측**

## 3. 시간 관계

```
과거 데이터 (X)     현재 시점       미래 수익률 (y)
[====== T일 =====]    asof    [====== 1개월 =====]
                    ↓                    ↓
                입력 구간            출력 구간
```

## 결론

✅ **올바른 구성:**
- 입력 X: asof 시점 기준 **과거 T 영업일** 데이터
- 출력 y: asof 시점 기준 **다음 월말까지의 수익률**
- 시간 순서: 과거 → 현재 → 미래 (올바름)

✅ **데이터 누수 없음:**
- X는 asof 시점만 포함 (미래 정보 없음)
- y는 asof 이후의 수익률 (학습 가능)

✅ **예시 데이터 흐름:**
```
asof = 2021-05-31 (월말)

입력 X: [2021-05-06 ~ 2021-05-31] 20영업일 특성 데이터
   - log_return, vol_z, volatility20, mom20

출력 y: 2021-05-31 가격 대비 2021-06-30 가격 수익률
   - >= +10%: 2
   - +5% ~ < +10%: 1
   - else: 0
```

